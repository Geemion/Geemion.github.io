<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Linux木马分析初体验（BillGates及XORDDOS查杀） | Lyon&#39;s blog</title>
  <meta name="author" content="Lyon">
  
  <meta name="description" content="Walk steps step by step">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Linux木马分析初体验（BillGates及XORDDOS查杀）"/>
  <meta property="og:site_name" content="Lyon&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  #<link href="/favicon.ico" rel="icon">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="alternate" href="/atom.xml" title="Lyon&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?1d807422614f63c8de98cdc3b546860c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
  <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
    
  <script data-ad-client="ca-pub-6317609007693835" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66542057-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-66542057-1');
</script>

</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Lyon&#39;s blog</a></h1>
  <h2><a href="/">I hear and I forget.I see and I remember.I do and I understand.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/about">关于</a></li>
    
	<li> <a href="/atom.xml">RSS</a> </li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2016-08-25T04:05:26.000Z"><a href="/2016/08/25/Learning/Linux-malware-billgates-XORDDOS-analyze-first-time/">2016-08-25</a></time>
      
      
  
    <h1 class="title">Linux木马分析初体验（BillGates及XORDDOS查杀）</h1>
  

    </header>
	
<!-- Table of Contents -->

  <div id="toc" class="toc-article">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BillGates"><span class="toc-number">1.</span> <span class="toc-text">BillGates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态分析"><span class="toc-number">1.1.</span> <span class="toc-text">静态分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态分析"><span class="toc-number">1.2.</span> <span class="toc-text">动态分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#清理"><span class="toc-number">1.3.</span> <span class="toc-text">清理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#清理及监控"><span class="toc-number">2.</span> <span class="toc-text">清理及监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主要参考资料"><span class="toc-number">3.</span> <span class="toc-text">主要参考资料</span></a></li></ol>
  </div>


	
    <div class="entry">
      
        <div align="center"><br><img src="/img/20160826billgates_XORDDOSsumary.png" align="center"><br></div>

<p>分析工具：</p>
<ul>
<li>ida pro</li>
<li>edb</li>
<li>strace</li>
</ul>
<p>事情是这样的，某一天发现某一台服务器数据流量异常，怀疑中了木马而且是一台Windows机器，想着就能一展我手动杀毒的技能了，但是开了机才发下这台机器上通过Hyper-V装了另外5台虚拟机，比我想象中复杂多了而且在机房狭小的环境中。在几台Windows机器上找了良久也未发现木马的踪迹，难道是什么高级木马？好在师兄经验丰富一想肯定是剩下的那台centos有问题，果然一找一大堆，billgates附送个xorddos，不是说linux很安全么，怎么会中马呢？ linux是很安全但是耐不住用的人没安全意识啊，直接暴露在公网的主机被设置了ssh弱密码。好了故事编完了，进入正题，这篇博客主要是这两天的linux系统下的木马分析与查杀的一个简单记录。</p>
<h2 id="BillGates">BillGates</h2><p>BillGates就是上面那个比重最大的Linux.BackDoor.Gates.5，2014年就被drweb曝光过，网上很多分析的很多了，但是还是自己跟着走一遍还是能学到很多东西的，特别是第一次分析Linux木马的我。</p>
<h3 id="静态分析">静态分析</h3><p>基本信息<br><a id="more"></a><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">backbox@backbox-virtual-machine:~/Desktop/ctf/tmp$ md5sum lang</span><br><span class="line">779d77646d84cc012c5da5c01ea592c6  lang</span><br><span class="line">backbox@backbox-virtual-machine:~/Desktop/ctf/tmp$ file lang</span><br><span class="line">lang: ELF 32-bit LSB  executable, Intel 80386, version 1 (SYSV), statically linked, for GNU/Linux 2.2.5, not stripped</span><br><span class="line">backbox@backbox-virtual-machine:~/Desktop/ctf/tmp$ readelf -a lang|grep FILE|awk '&#123;print $8&#125;'|sort -u</span><br><span class="line">AmpResource.cpp</span><br><span class="line">Attack.cpp</span><br><span class="line">AutoLock.cpp</span><br><span class="line">CmdMsg.cpp</span><br><span class="line">ConfigDoing.cpp</span><br><span class="line">crtstuff.c</span><br><span class="line">DNSCache.cpp</span><br><span class="line">ExChange.cpp</span><br><span class="line">FileOp.cpp</span><br><span class="line">Global.cpp</span><br><span class="line">Ijduy.cpp</span><br><span class="line">Iysd76.cpp</span><br><span class="line">Log.cpp</span><br><span class="line">Main.cpp</span><br><span class="line">Manager.cpp</span><br><span class="line">Md5.cpp</span><br><span class="line">Media.cpp</span><br><span class="line">MiniHttpHelper.cpp</span><br><span class="line">NetBase.cpp</span><br><span class="line">ProtocolUtil.cpp</span><br><span class="line">ProvinceDns.cpp</span><br><span class="line">StatBase.cpp</span><br><span class="line">SysTool.cpp</span><br><span class="line">ThreadAtk.cpp</span><br><span class="line">ThreadClientStatus.cpp</span><br><span class="line">ThreadCondition.cpp</span><br><span class="line">ThreadConnection.cpp</span><br><span class="line">Thread.cpp</span><br><span class="line">ThreadDoFun.cpp</span><br><span class="line">ThreadFakeDetect.cpp</span><br><span class="line">ThreadHttpGet.cpp</span><br><span class="line">ThreadKillChaos.cpp</span><br><span class="line">ThreadLoopCmd.cpp</span><br><span class="line">ThreadMonGates.cpp</span><br><span class="line">ThreadMutex.cpp</span><br><span class="line">ThreadRecycle.cpp</span><br><span class="line">ThreadShell.cpp</span><br><span class="line">ThreadShellRecycle.cpp</span><br><span class="line">ThreadTask.cpp</span><br><span class="line">ThreadTns.cpp</span><br><span class="line">ThreadUpdate.cpp</span><br><span class="line">UserAgent.cpp</span><br><span class="line">Utility.cpp</span><br><span class="line">WinDefSVC.cpp</span><br></pre></td></tr></table></figure></p>
<p>从上面可以简单总结，这个木马是一个32位的elf文件，采用静态链接的方式（所以在ida中看不到导入表）可能是为了提高兼容性吧，支持2.2以上的linux系统，not stripped就是没有剔除符号信息（这就方便了我们逆向调试），从源文件名可以看书这个木马多线程多任务。<br>有了上面的信息我们就可以上ida了，是32位的（之前我想都没想认为是64位的直接上64位ida，但是工作的也不错反编译都没问题但是没有f5导致我绕了很大一圈）。<br><img src="/img/20160826billgates_ida_main.png" alt><br>直接上ida f5 main函数，大概就就是上面这个样子的，从ida来看大概有3900个函数，还是比较复杂了。整个木马的执行流程如下面这个图的样子，为什么这么快就能够弄出这么清晰的脉络呢？主要是符号信息没strip加上f5大法，况且360的分析也详细了，所以直接就出来了。不过在ida静态看的时候发现C++写的代码是要比C写的难分析，没用f5看的时候大部分函数名显示都是_ZNSt6vectorISsSaISsEEixEj这个样子的，主要可能就是C++的多态性显示吧，还有就是类成员指针this不知道从哪里冒出来的。<br><img src="/img/20160826billgates_mainfun.png" alt></p>
<h3 id="动态分析">动态分析</h3><p>静态分析的时候通过函数名基本就可以看出功能这些了，但是获取其他的一些信息函数要动态调试一下，比如说控制端的地址，如果看静态代码然后自己写解密函数太复杂了。Linux的调试器首先想到的就是gdb但是对于用惯了Widnwos图形界面调试器的我用起来真的是太复杂了即使加了peda插件，所以首先就是找一个好的调试器，最终选择了<a href="https://github.com/eteran/edb-debugger" target="_blank" rel="external">edb</a>基本上和ollydbg无缝对接，按照readme编译安装就可以用了。<br><strong>下断点</strong><br>刚开始真的不知道怎么下断点，静态链接的也没导入表导入函数，然后熟悉了下edb发现默认的插件里面有SymbolViewer可以直接搜索函数然后下断点，根据前面的静态分析大概知道解密控制端地址在函数CSysTool::Ikdfu94()中然后搜索f2。这里还需要注意edb的堆栈窗口的显示设置，不然堆栈窗口看起来会怪怪的看不到什么东西，word width设置为4byte（因为32位系统嘛）然后row width 设置为1 word,这样才看起来正常。</p>
<div align="center"><br><img src="/img/20160826billgates_breakpoint.png" alt="断点情况" align="center"><br></div><br>这里动态调试主要是看看MainBeikong主功能安装函数部分，看能不能找出控制端的地址。<br><div align="center"><br><img src="/img/20160826billgates_filesize1.png" align="center"><br></div><br><div align="center"><br><img src="/img/20160826billgates_filesize.png" alt="初始化一些校验量部分及一些全局字符串" align="center"><br></div><br><div align="center"><br><img src="/img/20160826billgates_backaddress.png" alt="解密出一个控制端地址中间量" align="center"><br></div><br>在Ikdfu94()+1a1解密出一个控制端地址中间量，后面部分的0x8130800地址的位置ida会出现反编译失败的情况，而进入这里面会发现会在解密出一个控制端地址，搜索发现这个可能才是真正的控制端地址（反正没怎么搞清楚c++的代码逆向这些类成员怎么存的….），之前以为这个中间量就是控制端地址后面进入0x8130800后才发现这一步才是真正的解密出控制端的地址。<br><div align="center"><br><img src="/img/20160826billgates_0x8130800.png" alt="0x8130800部分代码" align="center"><br></div>

<div align="center"><br><img src="/img/20160826billgates_backaddress1.png" alt="解密出真正的控制端地址" align="center"><br></div>

<p>搜索发现这个域名和很多恶意软件都有关联，应该是个惯犯了。<a href="https://www.threatcrowd.org/domain.php?domain=www.007au.net" target="_blank" rel="external">https://www.threatcrowd.org/domain.php?domain=www.007au.net</a></p>
<div align="center"><br><img src="/img/20160826billgates_threatcrowd.png" alt="007au.net域名关联" align="center"><br></div>

<p>在路径/usr/bin/bsd-port/getty下主功能程序时解密的后台地址</p>
<div align="center"><br><img src="/img/20160826billgates_midaddress2.png" alt="主功能中间地址" align="center"><br></div>

<div align="center"><br><img src="/img/20160826billgates_finaladdress2.png" alt="最终控制端地址" align="center"><br></div>

<div align="center"><br><img src="/img/20160826billgates_2crowd.png" alt="2xpk.com域名关联" align="center"><br></div>

<p>参数格式：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="constant">C2-</span>ip&gt;<span class="symbol">:&lt;C2-port&gt;</span><span class="symbol">:&lt;Is</span> <span class="constant">Listener </span>?&gt;<span class="symbol">:&lt;IsService</span> ?&gt;<span class="symbol">:&lt;Campaign</span> <span class="constant">Name&gt;</span><span class="symbol">:&lt;Enable</span> <span class="constant">Backdoor </span>?&gt;</span><br></pre></td></tr></table></figure></p>
<div align="center"><br><img src="/img/20160826billgates_param.png" alt="参数格式" align="center"><br></div><br>总的来说目的基本达到了，应该是找到了控制端的地址，后面其他的太多了就没有继续分析了，看360分析的那篇文章感觉很庞大很复杂。<br>威胁情报相关：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">007</span>au.net</span><br><span class="line"><span class="number">775940302</span>@qq.com</span><br><span class="line">ss@qq.com</span><br><span class="line"><span class="number">513131779</span>@qq.com</span><br><span class="line"><span class="number">2</span>xpk.com</span><br><span class="line">tb8t.com</span><br><span class="line">daywin666@gmail.com</span><br></pre></td></tr></table></figure><br><br>### 清理及恢复系统<br><strong>清理</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/.sshd                   	               守护进程木马文件，首先应该被干掉</span><br><span class="line">/usr/bin/bsd-port/getty          	               主功能木马文件，直接删除</span><br><span class="line">/bin/、/usr/bin/、/usr/sbin/ 下netstat、lsof、ps或ss    过滤功能木马文件，通过文件大小可判断</span><br><span class="line">/tmp/lang                                              安装功能木马文件，直接删除</span><br><span class="line">/etc/rc.local                                         自启动配置文件，清理掉里面的含有木马路径的</span><br><span class="line">/etc/init.d/DbSecuritySpt                              自启动配置文件，直接删除</span><br><span class="line">/etc/rc[<span class="number">1</span>-<span class="number">5</span>].d/S97DbSecuritySpt                        自启动配置文件，直接删除</span><br><span class="line">/etc/rc[<span class="number">1</span>-<span class="number">5</span>].d/S99selinux                              自启动配置文件，直接删除</span><br><span class="line">/etc/conf.n                                            木马残留文件直接删                                                  </span><br><span class="line">/etc/cmd.n                                             木马残留脚本，直接删除</span><br><span class="line">/usr/lib/libamplify.so                                 木马残留可执行文件直接删除</span><br><span class="line">/usr/bin/bsd-port/conf.n                               木马残留文件直接删除</span><br><span class="line">/tmp<span class="comment">/*.lock</span><br><span class="line">/tmp/moni.lod</span><br><span class="line">/tmp/gates.lod</span></span><br></pre></td></tr></table></figure><br><br><strong>恢复</strong><br>替换的命令都是一些系统进程网络文件等检测系统异常的命令，不过好在进过分析这些命令都被备份/usr/bin/dpkgd/目录下，我们只需要将木马命令删除然后放回去就好了，实在不放心可以从一台正常的主机上拷贝这些命令。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/bin/netstat</span><br><span class="line">/bin/lsof</span><br><span class="line">/bin/ps</span><br><span class="line">/usr/bin/netstat</span><br><span class="line">/usr/bin/lsof</span><br><span class="line">/usr/bin/ps</span><br><span class="line">/usr/sbin/netstat</span><br><span class="line">/usr/sbin/lsof</span><br><span class="line">/usr/sbin/ps</span><br></pre></td></tr></table></figure><br><br>其他查杀参考:<br><a href="http://www.cnblogs.com/kerrycode/p/4754820.html" target="_blank" rel="external">记一次Linux服务器上查杀木马经历</a><br><br>## XORDDOS<br><div align="center"><br><img src="/img/20160826fireEye_XORDDO.png" alt="XOR木马DDOS攻击流程--fireeye" align="center"><br></div><br>### 静态分析<br>基本信息<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@backbox-virtual-machine:/home/backbox/Desktop/ctf# md5sum ylsfwpisem </span><br><span class="line">fb7991805655eb06e4380c1f703f0dcb  ylsfwpisem</span><br><span class="line">root@backbox-virtual-machine:/home/backbox/Desktop/ctf# file ylsfwpisem </span><br><span class="line">ylsfwpisem: ELF 32-bit LSB  executable, Intel 80386, version 1 (SYSV), statically linked, for GNU/Linux 2.6.9, not stripped</span><br><span class="line">root@backbox-virtual-machine:/home/backbox/Desktop/ctf# readelf -a ylsfwpisem |grep FILE|awk '&#123;print $8&#125;'|sort -u</span><br><span class="line">autorun.c</span><br><span class="line">buildnet.c</span><br><span class="line">crc32.c</span><br><span class="line">crtstuff.c</span><br><span class="line">dns.c</span><br><span class="line">encrypt.c</span><br><span class="line">execpacket.c</span><br><span class="line">findip.c</span><br><span class="line">hide.c</span><br><span class="line">http.c</span><br><span class="line">kill.c</span><br><span class="line">main.c</span><br><span class="line">proc.c</span><br><span class="line">socket.c</span><br><span class="line">tcp.c</span><br><span class="line">thread.c</span><br></pre></td></tr></table></figure><br><br>和BillGates一样，XOR也是32位的静态链接的elf文件同时有我们喜欢的符号信息，但是从源文件来看就有些不同了，首先源文件数量较少（XOR大小为648k，BillGates有差不多1.2M）而且是C语言来写的，看这些命名就感觉很亲切看网上说好像是中国人写得，难怪哈哈。从名称来看有自启动、tcp、隐藏加密等功能所以可以看出xor相比BillGates要简单并且好分析得多。<br><br><em>由于最近事情比较多这里就没写了，可以看参考链接，比较详细基本相似</em><br>xor ddos字符解密脚本<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#-*- coding:utf-8 -*-</span><br><span class="line">#dec_conf.py</span><br><span class="line">#xorddos 解密脚本</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def dec_conf(payload):</span><br><span class="line">	key="BB2FA36AAA9541F0"</span><br><span class="line">	dec_payload=[]</span><br><span class="line">	for i in range(len(payload)):</span><br><span class="line">		dec_payload.append(chr(ord(payload[i])^ord(key[i%len(key)])))</span><br><span class="line">	print ''.join(dec_payload)</span><br><span class="line"></span><br><span class="line">if __name__=='__main__':</span><br><span class="line">	dec_conf(sys.argv[1])</span><br><span class="line"></span><br><span class="line">char xorkeys[17]="BB2FA36AAA9541F0";</span><br><span class="line">void *__cdecl encrypt_code(void *buf, int count)</span><br><span class="line">&#123;</span><br><span class="line">	char *p; // [sp+4h] [bp-Ch]@1</span><br><span class="line">	signed int i; // [sp+8h] [bp-8h]@1</span><br><span class="line"></span><br><span class="line">	p = (char *)buf;</span><br><span class="line">	i = 0;</span><br><span class="line">	while ( i &lt; count )</span><br><span class="line">	&#123;</span><br><span class="line">		*p ^= xorkeys[i++ % 16];</span><br><span class="line">		++p;</span><br><span class="line">	&#125;</span><br><span class="line">	return buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>### 动态分析<br><br><a href="http://www.cnblogs.com/goabout2/p/4888669.html" target="_blank" rel="external">linux xorddos样本分析2</a><br><br><div align="center"><br><img src="/img/20160826_XORDDOS_backaddr.png" alt="xorddos样本后台地址" align="center"><br></div>

<p>样本后台地址godaddy.gdgaoxiang.com:5858|119.147.145.216:2897,可以看到这个域名想冒充godaddy这个域名服务商，</p>
<div align="center"><br><img src="/img/20160826billgates_XORDDOS_mail.png" align="center"><br></div><br><div align="center"><br><img src="/img/20160826billgates_XORDDOS_mail2.png" align="center"><br></div><br><div align="center"><br><img src="/img/20160826billgates_XORDDOS_mail3.png" alt="gdgaoxiang.com域名及ip威胁情报信息" align="center"><br></div>

<p>域名godaddy.gdgaoxiang.com的威胁情报分析看还比较赶紧没什么做坏事的痕迹，但是ip地址的威胁情报分析来看就是劣迹累累，与这个域名相关的病毒不仅有ddos还有最近流行的敲诈勒索软件Tescrypt。<br>相关情报如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">info1<span class="number">.300</span></span><br><span class="line">godaddy.gdgaoxiang.com</span><br><span class="line">www.gdgaoxiang.com</span><br><span class="line">ly70cc.gdgaoxiang.com</span><br><span class="line">ftp.gdgaoxiang.com</span><br><span class="line">yueliang1235@gmail.com</span><br><span class="line">cs@<span class="number">0662.</span>com.cn</span><br><span class="line">gd500d@<span class="number">126.</span>com</span><br><span class="line"><span class="number">13326596866</span> </span><br><span class="line"><span class="number">1774930466</span>@qq.com</span><br><span class="line">game000123.com</span><br><span class="line">hmgyddos.game8888888.com</span><br></pre></td></tr></table></figure></p>
<h3 id="清理">清理</h3><p>可能的木马文件目录<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/[<span class="number">10</span> random characters a-z]</span><br><span class="line">/etc/init.d/[<span class="number">10</span> random characters a-z]</span><br><span class="line">/usr/bin/[Session ID]</span><br><span class="line">/etc/init.d/[Session ID]</span><br><span class="line">/etc/rc1.d/S90[Session ID]</span><br><span class="line">/etc/rc2.d/S90[Session ID]</span><br><span class="line">/etc/rc3.d/S90[Session ID]</span><br><span class="line">/etc/rc4.d/S90[Session ID]</span><br><span class="line">/etc/rc5.d/S90[Session ID]</span><br><span class="line">/etc/rc.d/rc1.d/S90[Session ID]</span><br><span class="line">/etc/rc.d/rc2.d/S90[Session ID]</span><br><span class="line">/etc/rc.d/rc3.d/S90[Session ID]</span><br><span class="line">/etc/rc.d/rc4.d/S90[Session ID]</span><br><span class="line">/etc/rc.d/rc5.d/S90[Session ID]</span><br><span class="line">/var/run/sftp.pid</span><br><span class="line">/var/run/udev.pid</span><br><span class="line">/var/run/mount.pid</span><br><span class="line">/etc/cron.hourly/cron.sh</span><br><span class="line">/etc/cron.hourly/udev.sh</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.hourly/udev.sh</span><br><span class="line">/lib/libgcc.so</span><br><span class="line">/lib/libgcc.so.bak</span><br><span class="line">/lib/libgcc4.so</span><br><span class="line">/lib/libgcc4<span class="number">.4</span>.so</span><br><span class="line">/lib/udev/udev</span><br><span class="line">/lib/udev/debug</span><br></pre></td></tr></table></figure></p>
<h2 id="清理及监控">清理及监控</h2><p><a href="https://github.com/JoyChou93/kill_ddos_backdoor" target="_blank" rel="external">kill_ddos_backdoor</a><br><a href="https://github.com/ValdikSS/billgates-botnet-tracker" target="_blank" rel="external">billgates-botnet-tracker</a></p>
<h2 id="主要参考资料">主要参考资料</h2><p><a href="http://news.drweb.cn/show/?i=230&amp;" target="_blank" rel="external">Linux.BackDoor.Gates.5——又一针对Linux的木马</a><br><a href="http://www.freebuf.com/articles/92289.html" target="_blank" rel="external">某僵尸网络被控端恶意样本分析</a><br><a href="https://security.tencent.com/index.php/blog/msg/83" target="_blank" rel="external">云端博弈——木马屠城</a><br><a href="http://bartblaze.blogspot.com/2015/09/notes-on-linuxxorddos.html" target="_blank" rel="external">Notes on Linux/Xor.DDoS</a><br><a href="https://www.fireeye.com/blog/threat-research/2015/02/anatomy_of_a_brutef.html" target="_blank" rel="external">ANATOMY OF A BRUTE FORCE CAMPAIGN: THE STORY OF HEE THAI LIMITED</a><br><a href="http://www.cnblogs.com/goabout2/p/4888651.html" target="_blank" rel="external">linux xorddos样本分析1</a><br><a href="https://www.akamai.com/us/en/multimedia/documents/state-of-the-internet/bill-gates-botnet-threat-advisory.pdf#pdfjs.action=download" target="_blank" rel="external">bill-gates-botnet-threat-advisory</a></p>
<p><em>20161031更新–腾讯电脑管家的分析主要利用了其他几种工具</em><br><a href="http://www.freebuf.com/articles/system/117823.html" target="_blank" rel="external">Linux平台“盖茨木马”分析</a></p>
<p><em>20161104更新</em><br><a href="http://www.antiy.com/response/EQUATIONS/EQUATIONS.html" target="_blank" rel="external">从“方程式”到“方程组”EQUATION攻击组织高级恶意代码的全平台能力解析</a></p>

      
    </div>
    <footer>
      

        
          <div class="alignleft post-nav">
            <em>上一篇: </em><a href="/2016/10/02/Debug/the-reasons-of-Dll-hijiacking-msimg32-fail/">msimg32.dll劫持失败原因分析</a>
          </div>
        
        
          <div class="alignright post-nav">
            <em>下一篇: </em><a href="/2016/07/27/Debug/debug-vulner-UAF-2011-0065/">漏洞调试-释放重引用UAF-cve-2011-0065</a>
          </div>
          <div class="clearfix"></div>
        

        
          <div class="copyright">
            
              <span class="claim">转载请注明youngroe.com</span>
            
            
              <span class="from-link">
                <em>本文链接地址:</em>
                <a href="/2016/08/25/Learning/Linux-malware-billgates-XORDDOS-analyze-first-time/">
                  http://www.youngroe.com/2016/08/25/Learning/Linux-malware-billgates-XORDDOS-analyze-first-time/
                </a>
              </span>
            
          </div>
        
        
  
  <div class="categories">
    <a href="/categories/Learning/">Learning</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>, <a href="/tags/Malware/">Malware</a>
  </div>

        
          <! -- 添加捐赠图标 -->
<div class ="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           ↑<br>
           欣赏此文？求鼓励，求支持！
        </span>
        <br>
      </div>  
    <div id="donate_guide" class="donate_bar center hidden" >
        <!-- 方式一： 
            ![](/img/Alipay.jpg)
            ![](/img/WeChatpay.jpg)
        -->
        <!-- 方式二；
            step1：在_config.yml中添加配置
                Alipay: /img/Alipay.jpg
                WeChatpay: /img/WeChatpay.jpg
            step2：此处两张图片的路径分别设置为如下
                <img src="undefined"
                <img src="undefined"
        -->
        <!-- 支付宝打赏图案 -->
        <img src="/img/Alipay.png" alt="支付宝打赏">
        <!-- 微信打赏图案 -->
        <img src="/img/WeChatpay.png" alt="微信打赏">
    </div>
    <script type="text/javascript">
        document.getElementById('btn_donate').onclick = function(){
            $('#donate_board').addClass('hidden');
            $('#donate_guide').removeClass('hidden');
        }
    </script>
</div>
<! -- 添加捐赠图标 -->
        
        <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
  clientID: '503c39aa3fb2b8c1b734',
  clientSecret: '65d784ff7a95a9dbf4a4208c9e32166ca29654f2',
  repo: 'geemion.github.io',
  owner: 'geemion',
  admin: 'geemion',
  pagerDirection:'first',
  id: md5(window.location.pathname)
})

gitalk.render('gitalk-container')
</script>
      
      <div class="clearfix"></div>
    </footer>
  </div>
  <div id="container"></div>
</span>
</article>


<section id="comment">
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Cybersecurity/">Cybersecurity</a><small>6</small></li>
  
    <li><a href="/categories/Debug/">Debug</a><small>7</small></li>
  
    <li><a href="/categories/IOT/">IOT</a><small>6</small></li>
  
    <li><a href="/categories/Kernel/">Kernel</a><small>4</small></li>
  
    <li><a href="/categories/Learning/">Learning</a><small>5</small></li>
  
    <li><a href="/categories/Life/">Life</a><small>5</small></li>
  
    <li><a href="/categories/Others/">Others</a><small>1</small></li>
  
    <li><a href="/categories/Tools/">Tools</a><small>5</small></li>
  
    <li><a href="/categories/Vulnerabilities/">Vulnerabilities</a><small>0</small></li>
  
    <li><a href="/categories/Windows/">Windows</a><small>13</small></li>
  
    <li><a href="/categories/life/">life</a><small>0</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2021/10/20/IOT/using-rasberrypi-as-poor-mans-hardware-hacking-tool/">树莓派-穷人的硬件黑客工具（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/09/22/IOT/iot-security-part-4-bluetooth-low-energy-101/">物联网安全101-4.低功耗蓝牙BLE（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/09/22/IOT/iot-security-part-3-101-iot-top-ten-vulnerabilities/">物联网安全101-3.物联网10大安全漏洞（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/09/21/IOT/iot-security-part-2-101-iot-attack-surface/">物联网安全101-2.物联网攻击面（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/09/21/IOT/iot-security-part-1-101-iot-introduction-architecture/">物联网安全101-1.物联网介绍及其架构（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/08/20/Cybersecurity/guide-linux-privilege-escalation/">Linux权限提升指南（翻译）</a>
      </li>
    
      <li>
        <a href="/2021/03/20/IOT/powerpc_binary_blob_firmware_reverse/">一次嵌入式固件逆向实践</a>
      </li>
    
      <li>
        <a href="/2020/10/02/Cybersecurity/art-of-anti-detection-4-art-of-anti-detection-4-self-defense/">反检测的艺术4-自保护（翻译）</a>
      </li>
    
      <li>
        <a href="/2020/09/10/Cybersecurity/art-of-anti-detection-3-art-of-anti-detection-3-shellcode-alchemy/">反检测的艺术3-shellcode的魔力 （翻译）</a>
      </li>
    
      <li>
        <a href="/2020/09/04/Cybersecurity/art-of-anti-detection-2-pe-backdoor-manufacturing/">反检测的艺术2-如何制作PE文件后门（翻译）</a>
      </li>
    
      <li>
        <a href="/2020/09/03/Cybersecurity/art-of-anti-detection-1-introduction-to-av-detection-techniques/">反检测的艺术1-反病毒软件及检测技术概述（翻译）</a>
      </li>
    
      <li>
        <a href="/2020/08/02/Life/dns_hijacking/">记录一次被DNS劫持及解决方案(非改hosts方式)</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Boost/" style="font-size: 10px;">Boost</a> <a href="/tags/DDoS/" style="font-size: 10px;">DDoS</a> <a href="/tags/DNS-over-HTTPS/" style="font-size: 10px;">DNS-over-HTTPS</a> <a href="/tags/DNS劫持/" style="font-size: 10px;">DNS劫持</a> <a href="/tags/Delphi/" style="font-size: 10px;">Delphi</a> <a href="/tags/Dll劫持/" style="font-size: 10px;">Dll劫持</a> <a href="/tags/GetVersionEx/" style="font-size: 10px;">GetVersionEx</a> <a href="/tags/Http/" style="font-size: 10px;">Http</a> <a href="/tags/IDA-Pro/" style="font-size: 12px;">IDA Pro</a> <a href="/tags/IOT安全/" style="font-size: 18px;">IOT安全</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/MSDN/" style="font-size: 12px;">MSDN</a> <a href="/tags/Malware/" style="font-size: 12px;">Malware</a> <a href="/tags/MiniDumpWriteDump/" style="font-size: 10px;">MiniDumpWriteDump</a> <a href="/tags/PEB/" style="font-size: 10px;">PEB</a> <a href="/tags/Procmon/" style="font-size: 10px;">Procmon</a> <a href="/tags/Runtime-Error/" style="font-size: 10px;">Runtime Error</a> <a href="/tags/SEH/" style="font-size: 10px;">SEH</a> <a href="/tags/SysinternalsSuite/" style="font-size: 10px;">SysinternalsSuite</a> <a href="/tags/Tips/" style="font-size: 10px;">Tips</a> <a href="/tags/UAC/" style="font-size: 10px;">UAC</a> <a href="/tags/UAF漏洞/" style="font-size: 10px;">UAF漏洞</a> <a href="/tags/VC/" style="font-size: 10px;">VC</a> <a href="/tags/Visual-Studio/" style="font-size: 12px;">Visual Studio</a> <a href="/tags/Windbg/" style="font-size: 10px;">Windbg</a> <a href="/tags/Windows/" style="font-size: 20px;">Windows</a> <a href="/tags/getaddrinfo/" style="font-size: 10px;">getaddrinfo</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/libeay32/" style="font-size: 10px;">libeay32</a> <a href="/tags/x64/" style="font-size: 10px;">x64</a> <a href="/tags/内核/" style="font-size: 12px;">内核</a> <a href="/tags/内核结构/" style="font-size: 14px;">内核结构</a> <a href="/tags/反病毒/" style="font-size: 16px;">反病毒</a> <a href="/tags/安全机制/" style="font-size: 10px;">安全机制</a> <a href="/tags/异常处理/" style="font-size: 10px;">异常处理</a> <a href="/tags/提权/" style="font-size: 12px;">提权</a> <a href="/tags/服务/" style="font-size: 10px;">服务</a> <a href="/tags/权限/" style="font-size: 12px;">权限</a> <a href="/tags/栈溢出漏洞/" style="font-size: 10px;">栈溢出漏洞</a> <a href="/tags/测试/" style="font-size: 10px;">测试</a> <a href="/tags/漏洞调试/" style="font-size: 12px;">漏洞调试</a> <a href="/tags/生活/" style="font-size: 14px;">生活</a> <a href="/tags/脱壳/" style="font-size: 10px;">脱壳</a> <a href="/tags/西安/" style="font-size: 10px;">西安</a> <a href="/tags/计划/" style="font-size: 10px;">计划</a> <a href="/tags/读书/" style="font-size: 10px;">读书</a> <a href="/tags/调试/" style="font-size: 14px;">调试</a> <a href="/tags/转换/" style="font-size: 10px;">转换</a> <a href="/tags/进程/" style="font-size: 10px;">进程</a> <a href="/tags/逆向/" style="font-size: 10px;">逆向</a> <a href="/tags/重庆/" style="font-size: 10px;">重庆</a> <a href="/tags/驱动/" style="font-size: 14px;">驱动</a>
  </div>
</div>


  <div class="widget tag">
<h3 class="title">Links</h3>
<ul class="entry">
<li><a href="http://blog.ourren.com/" title="Ourren">Ourren</a></li>
<li><a href="http://www.hyjal.net/" title="Hyjal">Hyjal</a></li>
<li><a href="http://www.jianshu.com/users/fa15f4e416ae/latest_articles" title="Daemonceltics">Daemonceltics</a></li>
<li><a href="http://papap.info/" title="isee">isee</a></li>
</ul>
</div>

  <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=putG&d=yoFnN6V-ovhL-H4e9_69LvkTiX4uX7rEYJ15yL3G1Wg"></script>
</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2021 Lyon
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>

</body>

</html>